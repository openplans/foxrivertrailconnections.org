/*! planbox 2014-12-04 */

var Planbox=Planbox||{};!function(a,b){"use strict";a.Utils={pasteHtmlAtCaret:function(a,b){var c,d;if(window.getSelection){if(c=window.getSelection(),c.getRangeAt&&c.rangeCount){d=c.getRangeAt(0),d.deleteContents();var e=document.createElement("div");e.innerHTML=a;for(var f,g,h=document.createDocumentFragment();f=e.firstChild;)g=h.appendChild(f);var i=h.firstChild;d.insertNode(h),g&&(d=d.cloneRange(),d.setStartAfter(g),b?d.setStartBefore(i):d.collapse(!0),c.removeAllRanges(),c.addRange(d))}}else if((c=document.selection)&&"Control"!==c.type){var j=c.createRange();j.collapse(!0),c.createRange().pasteHTML(a),b&&(d=c.createRange(),d.setEndPoint("StartToStart",j),d.select())}},htmlEscape:function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},sortByInnerHTML:function(a){var c,d=[];return a=b(a),a.each(function(a,b){c=_.sortedIndex(d,b,function(a){return a.innerHTML}),d.splice(c,0,b)}),d},pathJoin:function(){var a,b,c="";for(a=0;a<arguments.length;++a)b=arguments[a],"/"===b[0]?c=b:c+=""===c||"/"===c[c.length-1]?b:"/"+b;return c},rootPathJoin:function(){var b=Array.prototype.slice.call(arguments,0);return b.unshift(a.bootstrapped.projectRootPath),a.Utils.pathJoin.apply(this,b)},guid:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},runHook:function(b,c,d,e){d=_.defaults(d||{},{startIndex:0,done:function(){},args:[]});var f,g,h=d.startIndex;if(h<_.size(b))do f=b[h],h+=1;while(f&&!f[c]);f?(g=d.args.concat([{nextHook:function(){a.Utils.runHook(b,c,_.extend({},d,{startIndex:h}))}}]),f[c].apply(f,g)):d.done.apply(e,d.args)},logEvents:function(c,d){b(c).on("click","[data-log-click]",function(){var c=b(this),e=d,f="click: "+(c.attr("data-ga-action")||c.text());a.Utils.log("USER",e,f)})},log:function(){var b=Array.prototype.slice.call(arguments,0);window.Intercom&&"support"===b[0].toLowerCase()?this.support(b):window.ga&&"support"!==b[0].toLowerCase()?this.analytics(b):a.Utils.console.log(b)},support:function(a){{var b;a[1]}a.length>2&&(b=a[2]),window.Intercom("trackEvent",a[1],a[2])},analytics:function(a){var b,c,d=a.shift(),e={"center-lat":"metric1","center-lng":"metric2",zoom:"metric3","panel-state":"dimension1"};switch(d.toLowerCase()){case"route":a=["send","pageview"].concat(a);break;case"user":a=["send","event"].concat(a);break;case"app":if(b=a.shift(),c=e[b],!c)return void this.console.error('No metrics or dimensions matching "'+b+'"');a=["set",c].concat(a);break;default:return}window.ga.apply(window,a)},console:window.console||{log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}},merge:function(a,b){for(var c,d,e=0,f=0,g=a.length,h=b.length,i=[];g>e&&h>f;)c=a[e],d=b[f],d>c?(i.push(c),e++):c>d?(i.push(d),f++):(i.push(c),e++,f++);return g>e&&i.splice(i.length,0,a.slice(e)),h>f&&i.splice(i.length,0,b.slice(f)),i}}}(Planbox,jQuery);var Planbox=Planbox||{};!function(a,b){"use strict";Handlebars.registerHelper("debug",function(a){return JSON.stringify(a)}),Handlebars.registerHelper("makeUniquifier",function(b,c){c||(c=b,b="uniquifier");var d={};return d[b]=a.Utils.guid(),c.fn(_.extend({},this,d))}),Handlebars.registerHelper("lookup",function(a,b,c){var d;return a&&(d=a[b]),c&&c.fn?d?c.fn(d):c.inverse(this):d}),Handlebars.registerHelper("resolve",function(a,b,c){var d,e,f=b?b.split("."):[],g=a;for(e=0;e<f.length&&g;e++)d=f[e],g=g[d];return c&&c.fn?g?c.fn(g):c.inverse(this):g}),Handlebars.registerHelper("buildContext",function(a){var b=a.hash;return a.fn(b)}),Handlebars.registerHelper("sortByInnerHTML",function(c){var d=b(c.fn(this)),e=a.Utils.sortByInnerHTML(d),f=b("<div/>").append(e);return f.html()}),Handlebars.registerHelper("isAny",function(a,b){var c=_.rest(_.initial(arguments)),d=!1,e=function(a){return _.isFunction(a)?a():a};return b=_.last(arguments),a=e(a),d=!!_.find(c,function(b){return b=e(b),a&&a===b?!0:void 0}),d?b.fn(this):b.inverse(this)}),Handlebars.registerHelper("window_location",function(){return window.location.toString()}),Handlebars.registerHelper("static_url",function(){return a.bootstrapped.staticUrl}),Handlebars.registerHelper("if_fileapi_support",function(a,b){return FileAPI.support[a]?b.fn(this):b.inverse(this)}),Handlebars.registerHelper("has_key",function(a,b,c){return a[b]?c.fn(this):c.inverse(this)}),Handlebars.registerHelper("each_active_section",function(a,b){var c="",d=this;return _.each(a,function(a){a.active&&(c+=b.fn(_.extend({},d,a)))}),c}),Handlebars.registerHelper("gte_active_section_length",function(a,b,c){var d=_.filter(a,function(a){return a.active&&a.menu_label}).length;return d>=b?c.fn(this):c.inverse(this)}),Handlebars.registerHelper("has_section_type",function(b,c){var d=!!a.app.sectionCollection.find(function(a){return a.get("type")===b});return d?c.fn(this):c.inverse(this)}),Handlebars.registerHelper("contact_email",function(){return a.Data.contactEmail});var c=function(a,b,c){return c?a[b]:(c=b,a?c.fn(a):c.inverse(this))};Handlebars.registerHelper("bootstrapped",function(b,d,e){return c(a.Data[b],d,e)}),Handlebars.registerHelper("user",function(b,d){return c(a.Data.user,b,d)}),Handlebars.registerHelper("owner",function(b,d){return c(a.Data.owner,b,d)}),Handlebars.registerHelper("eachUsers",function(b,c){var d=a.Data.user[b],e="";return d&&d.length>0?_.each(d,function(a){e+=c.fn(a)}):e=c.inverse(this),e}),Handlebars.registerHelper("status_label",function(b){var c=_.findWhere(a.Data.statuses,{value:b});return c?c.label:a.Data.statuses[0].label}),Handlebars.registerHelper("each_status",function(b){var c="",d=this;return _.each(a.Data.statuses,function(a){c+=b.fn(_.extend(d,a))}),c}),Handlebars.registerHelper("select",function(a,c){var d=b("<div/>").html(c.fn(this)),e=function(a){d.find('[value="'+a+'"]').attr({checked:"checked",selected:"selected"})};return _.isArray(a)?_.each(a,e):e(a),d.html()}),Handlebars.registerHelper("select_highlight",function(a,c,d){var e=b("<div/>").html(d.fn(this)),f=function(a){e.find('[value="'+a+'"]').attr({checked:"checked",selected:"selected"})};return"external"===a?e.find('[data-link-type="external"]').attr({checked:"checked",selected:"selected"}):f(c),e.html()}),Handlebars.registerHelper("filename",function(a){var b=a.substring(a.lastIndexOf("/")+1);return b}),Handlebars.registerHelper("formatdatetime",function(a,b){return a?moment(a).format(b):a}),Handlebars.registerHelper("fromnow",function(a){return a?moment(a).fromNow():""}),Handlebars.registerHelper("ispast",function(a,b){var c=new Date;return a=new Date(a),c>=a?b.fn(this):b.inverse(this)}),Handlebars.registerHelper("isfuture",function(a,b){var c=new Date;return a=new Date(a),a>c?b.fn(this):b.inverse(this)}),Handlebars.registerHelper("randomquote",function(){var a=["“True life is lived when tiny changes occur.” ‑ Leo Tolstoy","“It's a bad plan that admits of no modification.” ‑ Publilius Syrus","“It takes as much energy to wish as it does to plan.” ‑ Eleanor Roosevelt","“Planning is bringing the future into the present so that you can do something about it now.” ‑ Alan Lakein","“Always have a plan, and believe in it. Nothing happens by accident.” ‑ Chuck Knox","“A community is like a ship: everyone ought to be prepared to take the helm.” ‑ Henrik Ibsen","“It's not the plan that's important, it's the planning.” ‑ Dr. Gramme Edwards","“Plans are only good intentions unless they immediately degenerate into hard work.” ‑ Peter Drucker","“If you can dream it, you can do it.” ‑ Walt Disney","“Those who plan do better than those who do not plan even thou they rarely stick to their plan.” ‑ Winston Churchill","“Good plans shape good decisions. That's why good planning helps to make elusive dreams come true.” ‑ Lester Robert Bittel","“Prediction is difficult, especially about the future.” ‑ Yogi Berra","“Plans are nothing; planning is everything.” ‑ Dwight D. Eisenhower","“Alone we can do so little; together we can do so much.” ‑ Helen Keller","“Why do they call it rush hour when nothing moves?” ‑ Robin Williams"],b=Math.floor(Math.random()*a.length);return a[b]})}(Planbox,jQuery),function(a,b){"use strict";function c(b,c){this.element=b,this.options=a.extend({},e,c),this._defaults=e,this._name=d,this.init()}var d="fileUpload",e={url:null,data:{},dndOver:a.noop,dndDrop:a.noop,start:a.noop,progress:a.noop,complete:a.noop,maxWidthAttr:"data-max-width",maxHeightAttr:"data-max-height",validate:function(){return!0},imagePreview:null,thumbnail:!1};c.prototype.prefetchImage=function(a,c){var d=new b.Image;d.addEventListener("load",c,!1),d.src=a},c.prototype.previewImage=function(a,b){FileAPI.Image(a).get(function(c,d){var e;c||(e=d.toDataURL(a.type),b(e))})},c.prototype.upload=function(b){var c,d,e=a.proxy(function(b,d){FileAPI.upload({url:this.options.url,data:d,files:{file:b},imageTransform:c,cache:!0,upload:a.proxy(this.options.start,this.element),progress:a.proxy(this.options.progress,this.element),complete:a.proxy(this.options.complete,this.element)})},this),f=b[0],g=a.extend({"Content-Type":f.type},this.options.data),h=[f],i=a(this.element).attr(this.options.maxWidthAttr),j=a(this.element).attr(this.options.maxHeightAttr),k=0===f.type.indexOf("image/");this.options.validate(b)&&((i||j)&&k&&(c={maxWidth:i,maxHeight:j}),this.options.thumbnail&&k?(d=FileAPI.Image(f),d.preview(this.options.thumbnail.width,this.options.thumbnail.height),d.get(function(a,b){b.toBlob(function(a){a.name="thumbnail_"+f.name,h.push(a),e(h,g)},"image/png")})):e(h,g))},c.prototype.handleFileInputChange=function(a){a.preventDefault();var b=FileAPI.getFiles(a);this.upload(b)},c.prototype.initDropZone=function(b){FileAPI.support.dnd&&FileAPI.event.dnd(b,a.proxy(this.options.dndOver,this.element),a.proxy(this.options.dndDrop,this.element))},c.prototype.init=function(){a(this.element).find('input[type="file"]').on("change",a.proxy(this.handleFileInputChange,this)),this.initDropZone(this.element)},a.fn[d]=function(b){return this.each(function(){a.data(this,d)||a.data(this,d,new c(this,b))})}}(jQuery,window,document);var Planbox=Planbox||{};!function(a){"use strict";Backbone.Relational.store.addModelScope(a),a.ReorderableCollection=Backbone.Collection.extend({moveTo:function(a,b){var c=this.indexOf(a);c!==b&&(this.remove(a,{silent:!0}),this.add(a,{at:b,silent:!0}),this.trigger("reorder"))}}),a.DetailModel=Backbone.RelationalModel.extend({set:function(a,b,c){var d,e,f;"object"==typeof a?(e=a,c=b):(e={})[a]=b,c=c||{};for(d in e)_.contains(this.baseAttrs,d)||(f=f||e.details||_.clone(this.get("details"))||{},f[d]=e[d],delete e[d]);return f&&(e.details=f),Backbone.RelationalModel.prototype.set.call(this,e,c)}}),a.ProjectModel=a.DetailModel.extend({baseAttrs:["details","id","created_at","updated_at","title","slug","public","status","location","contact","owner","cover_img_url","logo_img_url","events","sections","template","layout","theme","description","geometry","expires_at","payment_type","last_opened_at","last_opened_by","last_saved_at","last_saved_by","happening_now_description","happening_now_link_type","happening_now_link_url","get_involved_description","get_involved_link_type","get_involved_link_url"],relations:[{type:Backbone.HasMany,key:"events",relatedModel:"EventModel",collectionType:"EventCollection"},{type:Backbone.HasMany,key:"sections",relatedModel:"SectionModel",collectionType:"SectionCollection",reverseRelation:{key:"project"}}],urlRoot:"/api/v1/projects",clean:function(){var a,b,c=this.get("events");c.each(function(d){a=d.get("label"),b=d.get("description"),(_.isUndefined(a)||_.isNull(a)||""===a.trim())&&(_.isUndefined(b)||_.isNull(b)||""===b.trim())&&c.remove(d)})},markAsOpenedBy:function(a,b){var c=this.url()+"/activity";$.ajax(_.defaults({type:"POST",url:c,data:JSON.stringify(a),dataType:"json"},b))},markAsClosed:function(a){var b=this.url()+"/activity";$.ajax(_.defaults({type:"DELETE",url:b,dataType:"json"},a))},pageUrl:function(){var a=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");return a+"/"+this.get("owner").slug+"/"+this.get("slug")+"/"}}),a.SectionModel=a.DetailModel.extend({baseAttrs:["details","id","created_at","updated_at","type","label","menu_label","slug","active"]}),a.SectionCollection=a.ReorderableCollection.extend({model:a.SectionModel}),a.AttachmentModel=Backbone.RelationalModel.extend({}),a.AttachmentCollection=a.ReorderableCollection.extend({model:a.AttachmentModel}),a.EventModel=a.DetailModel.extend({baseAttrs:["details","id","label","slug","description","index","project","datetime_label","start_datetime","end_datetime","attachments"],relations:[{type:Backbone.HasMany,key:"attachments",relatedModel:"AttachmentModel",collectionType:"AttachmentCollection"}]}),a.EventCollection=a.ReorderableCollection.extend({model:a.EventModel}),a.FaqModel=Backbone.RelationalModel.extend({}),a.FaqCollection=a.ReorderableCollection.extend({model:a.FaqModel}),a.RoundupModel=a.DetailModel.extend({baseAttrs:["details","id","created_at","updated_at","title","slug","owner","template","theme","projects"],relations:[{type:Backbone.HasOne,key:"owner",relatedModel:"OwnerProfileModel"},{type:Backbone.HasMany,key:"projects",relatedModel:"CollectedProjectModel",collectionType:"CollectedProjectCollection"}],urlRoot:"/api/v1/roundups"}),a.OwnerProfileModel=Backbone.RelationalModel.extend({}),a.CollectedProjectModel=Backbone.RelationalModel.extend({}),a.CollectedProjectCollection=Backbone.Collection.extend({model:a.CollectedProjectModel,url:"/api/v1/projects"}),a.ProfileModel=Backbone.RelationalModel.extend({urlRoot:"/api/v1/profiles",relations:[{type:Backbone.HasMany,key:"projects",relatedModel:"OwnedProjectModel",collectionType:"OwnedProjectCollection",reverseRelation:{key:"owner",includeInJSON:"slug"}},{type:Backbone.HasMany,key:"members",relatedModel:"MemberProfileModel"},{type:Backbone.HasMany,key:"teams",relatedModel:"TeamProfileModel",collectionType:"TeamProfileCollection"}]}),a.OwnedProjectModel=Backbone.RelationalModel.extend({}),a.OwnedProjectCollection=Backbone.Collection.extend({model:a.OwnedProjectModel,url:"/api/v1/projects"}),a.MemberProfileModel=Backbone.RelationalModel.extend({}),a.TeamProfileModel=Backbone.RelationalModel.extend({}),a.TeamProfileCollection=Backbone.Collection.extend({model:a.TeamProfileModel,url:"/api/v1/profiles"})}(Planbox);var Planbox=Planbox||{};!function(a,b){"use strict";a.ImageDropZonesMixin={initDropZones:function(){var c=this;this.ui.imageDropZones.fileUpload({url:"https://"+a.Data.s3UploadBucket+".s3.amazonaws.com/",data:_.clone(a.Data.s3UploadData),dndOver:function(a){b(this).toggleClass("file-dragging",a)},dndDrop:function(a){var c=b(this);c.removeClass("file-dragging"),c.data("fileUpload").upload(a)},validate:function(b){var c;for(c=0;c<b.length;c++)if(0!==b[c].type.indexOf("image/"))return a.showErrorModal("Unable to save that file.","This file doesn't seem to be an image file.","Make sure the file you're trying to upload is a valid image file and try again."),!1;return!0},start:function(a,c){var d=b(this),e=d.siblings(".image-holder");d.addClass("file-uploading"),d.data("fileUpload").previewImage(c.files.file[0],function(a){e.attr("src",a)})},complete:function(d,e,f){var g=b(this),h=g.siblings(".image-holder"),i=h.attr("data-attr"),j=window.encodeURI(f.url+f.data.key.replace("${filename}",f.files.file[0].name));return g.removeClass("file-uploading"),d?void a.showErrorModal("Unable to save that file.","We were unable to save your image.","Sorry about that. Please save your changes, reload the page, and try again. Please email us at "+a.Data.contactEmail+" if you have any more trouble."):(g.data("fileUpload").prefetchImage(j),void c.model.set(i,j))}})}},a.ContentEditableMixin={handleEditableBlur:function(a){var c=b(a.currentTarget),d=c.attr("data-attr"),e=c.is("[contenteditable]")?c.html():c.val();a.preventDefault(),this.model.set(d,e)},onRender:function(){this.initRichEditables()},initRichEditable:function(a){this.pen=new Pen({editor:a,list:["insertorderedlist","insertunorderedlist","bold","italic","createlink"],stay:!1})},canUsePen:function(){return"classList"in document.createElement("a")},initRichEditables:function(){var a=this;this.canUsePen()&&this.ui.richEditables&&this.ui.richEditables.each(function(b,c){a.initRichEditable(c)})}},a.SectionMixin={id:function(){return"section-"+this.model.get("slug")+"-wrapper"}},a.SectionAdminMixin={className:function(){return["project-section","project-section-"+this.model.get("type"),this.model.get("active")?"active":""].join(" ")},handleActivationChange:function(a){a.preventDefault();var c=!!b(a.currentTarget).val();this.$el.toggleClass("active",c),this.model.set("active",c)},handleDeleteSectionClick:function(a){a.preventDefault(),window.confirm("Really delete this section?")&&this.model.collection.remove(this.model)}},a.OrderedCollectionMixin={appendHtml:function(a,c,d){var e,f,g=a.collection,h=a.itemViewContainer?a.$(a.itemViewContainer):a.$el,i=h.children(),j=[],k=function(a,b){return a-b};if(i.each(function(){var a=b(this),c=a.data("item-cid"),d=g.get({cid:c}),e=g.indexOf(d);j.push(e)}),e=j.indexOf(d),-1===e)j.push(d),j.sort(k),e=j.indexOf(d);else for(j.splice(e,0,d),f=e+1;f<j.length;++f)j[f]++;0===e?h.prepend(c.el):h.children().eq(e-1).after(c.el),c.$el.data("item-cid",c.model.cid)}},a.FormErrorsMixin={onRender:function(){this.initValidityMessages()},initValidityMessages:function(){var a=this.$("[data-validity-message]");a.each(function(a,b){var c=b.getAttribute("data-validity-message");b.oninvalid=function(){b.setCustomValidity(""),b.validity.valid||b.setCustomValidity(c)},b.oninput=function(){b.setCustomValidity("")}})},showFormErrors:function(a){var b,c,d;for(b in a)d=this.$('[data-error-attr="'+b+'"]'),d.html('<small class="error error-message">'+this.getErrorMessage(d,b,a)+"</small>"),c=this.$('[data-attr="'+b+'"]'),c.addClass("error")},getErrorMessage:function(a){return a.attr("data-error-message")},clearErrors:function(){this.$(".error-message").remove(),this.$(".error").removeClass("error")},resetForm:function(){this.ui.form[0].reset(),this.clearErrors()}},a.MagellanMenuMixin={buildArrivalMap:function(){var a,c=b("[data-magellan-arrival]"),d=b("[data-magellan-destination]"),e={},f=[];return c.each(function(a,c){var d=b(c).attr("data-magellan-arrival");f.push(d)}),0===f.length?(this.arrivalMap=e,e):(a=f[0],d.each(function(c,d){var g=b(d).attr("data-magellan-destination");_.contains(f,g)&&(a=g),e[g]=a}),this.arrivalMap=e,e)},onDomRefresh:function(){var c=this,d=_.debounce(function(){var b,d,e,f,g,h=c.offsets();for(d=0;d<h.length;d++)if(b=h[d],b.viewport_offset>=b.top_offset)return e=b.arrival.attr("data-magellan-destination"),(_.isUndefined(c.arrivalMap)||_.isUndefined(c.arrivalMap[e]))&&c.buildArrivalMap(),f=c.arrivalMap[e],g=a.Utils.rootPathJoin(f),g!==c.currentPath&&(c.currentPath=g,a.Utils.log("ROUTE",g)),!0},500);b("[data-magellan-expedition]").length>0&&b("[data-magellan-arrival]").length>0&&(b(window).off("scroll",d).on("scroll",d),b(document).on("click","[data-magellan-link]",function(a){a.preventDefault();var c=b("[data-magellan-expedition]"),d=(c.data("magellan-expedition-init"),b(this).attr("href").split("#").join("")),e=b("a[name='"+d+"']");0===e.length&&(e=b("#"+d));var f=e.offset().top;f-=c.outerHeight(),b("html, body").stop().animate({scrollTop:f},700,"swing",function(){history.pushState?history.pushState(null,null,"#"+d):location.hash="#"+d})}))},onClickMenuItem:function(c){var d=b(c.currentTarget),e=d.attr("data-magellan-arrival");a.Utils.log("USER","project-display","menu-click",e)},onClickHighlight:function(c){var d=b(c.currentTarget),e=d.attr("data-highlight-type");a.Utils.log("USER","project-display","highlight-click",e)},offsets:function(){var a=b("[data-magellan-expedition]"),c=a.data("magellan-expedition-init")||{destination_threshold:20},d=c.destination_threshold,e=b(window).scrollTop();return b("[data-magellan-destination]").map(function(c,f){var g=b(f),h=g.offset().top-d-a.outerHeight();return{destination:g,arrival:b(this),top_offset:h,viewport_offset:e}}).sort(function(a,b){return a.top_offset<b.top_offset?1:a.top_offset>b.top_offset?-1:0})}}}(Planbox,jQuery);var Planbox=Planbox||{};!function(a,b){"use strict";a.BaseProjectSectionListView=Backbone.Marionette.CollectionView.extend({initialize:function(){this.options.itemViewOptions=this.getItemViewOptions},getItemViewOptions:function(b){var c=b.get("type"),d={parent:this};if("timeline"===c&&(d.collection=this.model.get("events")),"faqs"===c){var e=new a.FaqCollection(b.get("details"));e.on("change add remove reorder",function(){b.set("details",e.toJSON())}),d.collection=e}return d},getItemView:function(b){var c=b.get("type"),d=this.sectionViews[c];if(!d)throw a.projectException('Section type "'+c+'" unrecognized.',this.model.toJSON());return d}}),a.SortableListItemAdminView=Backbone.Marionette.Layout.extend({initialize:function(){this.$el.attr("data-id",this.model.cid)},handleDeleteClick:function(a){a.preventDefault(),window.confirm("Really delete?")&&this.model.collection.remove(this.model)}}),a.SortableListAdminView=Backbone.Marionette.CompositeView.extend({collectionEvents:{change:"dataChanged",add:"dataChanged",remove:"dataChanged",reorder:"dataChanged"},itemViewOptions:function(){return{parent:this.options.parent}},onRender:function(){this.initSortableItemList()},initSortableItemList:function(){var a=this;this.ui.itemList.sortable({handle:".handle",update:function(c,d){var e=b(d.item).attr("data-id"),f=a.collection.get(e),g=b(d.item).index();a.collection.moveTo(f,g)}})},handleAddClick:function(a){a.preventDefault(),this.collection.add({}),this.$(this.ui.newItemFocus.selector).focus()},dataChanged:function(){this.options.parent.dataChanged()}})}(Planbox,jQuery);var Planbox=Planbox||{};!function(a,b){"use strict";a.AttachmentView=Backbone.Marionette.Layout.extend({template:"#attachment-tpl",tagName:"li",className:"attachment",ui:{link:".attachment-link",title:".attachment-title"},events:{"click @ui.link":"onLinkClick"},onLinkClick:function(){var b=this.ui.title.text();a.Utils.log("USER","project-display","attachment-click",b)}}),a.AttachmentListView=Backbone.Marionette.CompositeView.extend({template:"#attachments-section-tpl",itemView:a.AttachmentView,itemViewContainer:".attachment-list"}),a.EventView=Backbone.Marionette.Layout.extend({template:"#event-tpl",tagName:"li",className:"event",regions:{attachmentList:".attachments-region"},ui:{showEventDetailsBtn:".show-event-details",eventDetails:".event-details"},events:{"click @ui.showEventDetailsBtn":"handleShowEventDetails"},onRender:function(){this.attachmentList.show(new a.AttachmentListView({model:this.model,collection:this.model.get("attachments")}));var c,d,e=new Date,f=this.$(".event-datetime").attr("data-datetime");c=new Date(f),c.setHours(0,0,0,0),d=new Date(f),d.setHours(11,59,59,999),this.$el.addClass(e>d?"past-event":"future-event");var g=this.model.get("details").tags;b.data(this.el,"tags",g)},handleShowEventDetails:function(a){a.preventDefault(),this.ui.eventDetails.toggleClass("hide")}}),a.TimelineSectionView=Backbone.Marionette.CompositeView.extend({template:"#timeline-section-tpl",tagName:"section",id:a.SectionMixin.id,className:"project-section-timeline",itemView:a.EventView,itemViewContainer:".event-list",ui:{showPastEventsBtn:".show-more-past-events",showFutureEventsBtn:".show-more-future-events",tagBtn:".tag-btn"},events:{"click @ui.showPastEventsBtn":"handleShowPastEventsBtn","click @ui.showFutureEventsBtn":"handleShowFutureEventsBtn","click @ui.tagBtn":"handleClickTagBtn"},onRender:function(){var a=this.$(".past-event").length,b=this.$(".future-event").length;a&&(this.$(".past-event").addClass("hide"),this.$(".show-more-past-events").removeClass("hide")),b>4&&(this.$(".future-event").slice(4).addClass("hide"),this.$(".show-more-future-events").removeClass("hide"))},showPastEvents:function(){b("li.past-event").removeClass("hide"),b(".show-more-past-events").addClass("hide")},showFutureEvents:function(){b("li.future-event").removeClass("hide"),b(".show-more-future-events").addClass("hide")},showEventsBySelectedTags:function(){var a=this.selectedTags;this.$("li.event").removeClass("hide"),0!==a.length&&this.$("li.event").each(function(c,d){var e=b.data(d,"tags")||[];0===_.intersection(a,e).length&&b(d).addClass("hide")})},handleShowPastEventsBtn:function(a){a.preventDefault(),this.showPastEvents()},handleShowFutureEventsBtn:function(a){a.preventDefault(),this.showFutureEvents()},handleClickTagBtn:function(a){a.preventDefault();var c=b(a.currentTarget),d=c.text();this.selectedTags=this.selectedTags||[],_.contains(this.selectedTags,d)?this.deselectTag(d,c):this.selectTag(d,c)},selectTag:function(a,b){this.ui.tagBtn.removeClass("selected").addClass("tertiary"),b&&b.addClass("selected").removeClass("tertiary"),this.selectedTags=[a],this.showPastEvents(),this.showFutureEvents(),this.showEventsBySelectedTags()},deselectTag:function(a,b){var c;b&&b.removeClass("selected").addClass("tertiary"),c=_.indexOf(this.selectedTags,a),this.selectedTags.splice(c,1),this.showPastEvents(),this.showFutureEvents(),this.showEventsBySelectedTags()},serializeData:function(){var b,c=a.TimelineSectionView.__super__.serializeData.call(this),d=[];return this.model.get("project").get("events").each(function(a){b=(a.get("details")||{}).tags||[],d=d.concat(b)}),c.tags=_.uniq(d.sort(),!0),c}}),a.TextSectionView=Backbone.Marionette.ItemView.extend({template:"#text-section-tpl",tagName:"section",id:a.SectionMixin.id,className:"project-section-text"}),a.ImageSectionView=Backbone.Marionette.ItemView.extend({template:"#image-section-tpl",tagName:"section",id:a.SectionMixin.id,className:"project-section-image"}),a.RawHtmlSectionView=Backbone.Marionette.ItemView.extend({template:"#raw-section-tpl",tagName:"section",id:a.SectionMixin.id,className:"project-section-raw"}),a.FaqView=Backbone.Marionette.ItemView.extend({template:"#faq-tpl",tagName:"div",className:"faq",ui:{question:"dt"},events:{"click @ui.question":"handleQuestionClick"},handleQuestionClick:function(b){b.preventDefault(),this.ui.question.toggleClass("is-selected");var c=this.ui.question.text(),d=this.ui.question.hasClass("is-selected")?"open":"close";a.Utils.log("USER","project-display","faq-click-"+d,c)}}),a.FaqsSectionView=Backbone.Marionette.CompositeView.extend({template:"#faqs-section-tpl",tagName:"section",id:a.SectionMixin.id,className:"project-section-faqs",itemView:a.FaqView,itemViewContainer:".faq-list"}),a.ShareaboutsSectionView=Backbone.Marionette.ItemView.extend({template:"#shareabouts-section-tpl",tagName:"section",id:a.SectionMixin.id,className:"project-section-shareabouts",ui:{shareabouts:".project-shareabouts"},getShareaboutsEl:function(){return this.ui.shareabouts},onShow:function(){var c,d=this.model.get("details"),e=d.templates;_.each(d.templates,function(a,b){_.isString(a)&&(e[b]=Handlebars.compile(a))}),c=new Shareabouts.Map({el:this.getShareaboutsEl(),map:d.map,layers:d.layers,placeStyles:(d.place_styles||[]).concat([{condition:"true",icon:{iconUrl:a.bootstrapped.staticUrl+"images/markers/dot-blue.png",iconSize:[18,18],iconAnchor:[9,9]},focusIcon:{iconUrl:a.bootstrapped.staticUrl+"images/markers/marker-blue.png",shadowUrl:a.bootstrapped.staticUrl+"images/markers/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,41]}}]),datasetUrl:d.dataset_url+"/places",templates:_.extend({},Handlebars.templates,e)}),Shareabouts.auth=new Shareabouts.Auth({apiRoot:"https://data.shareabouts.org/api/v2/",successPage:"/shareabouts/success",errorPage:"/shareabouts/error"}),b(Shareabouts.auth).on("authsuccess",function(a,d){c.setUser(d),b(document).foundation({dropdown:{}})}),Shareabouts.auth.initUser()}}),a.ModalView=Backbone.Marionette.ItemView.extend({template:"#modal-tpl",className:"reveal-modal medium",attributes:{"data-reveal":""},onShow:function(){this.$el.foundation().foundation("reveal","open")},onClose:function(){this.$el.foundation().foundation("reveal","close")}}),a.ProjectSectionListView=a.BaseProjectSectionListView.extend({sectionViews:{timeline:a.TimelineSectionView,text:a.TextSectionView,image:a.ImageSectionView,faqs:a.FaqsSectionView,shareabouts:a.ShareaboutsSectionView,raw:a.RawHtmlSectionView}}),a.ProjectView=Backbone.Marionette.Layout.extend(_.extend({},a.MagellanMenuMixin,{template:"#project-tpl",sectionListView:a.ProjectSectionListView,ui:{menuItems:".project-menu li",highlights:".highlight a"},events:{"click @ui.menuItems":"onClickMenuItem","click @ui.highlights":"onClickHighlight"},regions:{sectionList:"#section-list"},onShow:function(){this.sectionList.show(new this.sectionListView({model:this.model,collection:this.collection,parent:this}))}}))}(Planbox,jQuery);var Planbox=Planbox||{};!function(a,b){"use strict";a.ProjectView=Backbone.Marionette.Layout.extend(_.extend({},a.MagellanMenuMixin,{template:"#project-tpl",sectionListView:a.ProjectSectionListView,ui:{menuItems:".project-menu li",highlights:".highlight a",shareaboutsContainer:"#shareabouts-region"},events:{"click @ui.menuItems":"onClickMenuItem","click @ui.highlights":"onClickHighlight"},regions:{sectionList:"#section-list",shareaboutsRegion:"#shareabouts-region"},initialize:function(){this.shareaboutsSection=this.collection.find(function(a){return"shareabouts"===a.get("type")}),this.pageSections=new Backbone.Collection(this.collection.filter(function(a){return"shareabouts"!==a.get("type")}))},showShareaboutsSection:function(){this.shareaboutsView&&!this.shareaboutsView.isClosed&&(this.shareaboutsView.close?this.shareaboutsView.close():this.shareaboutsView.remove&&this.shareaboutsView.remove(),delete this.shareaboutsView),this.shareaboutsView=new a.ShareaboutsSectionView({model:this.shareaboutsSection,el:this.ui.shareaboutsContainer}),this.shareaboutsView.render(),Marionette.triggerMethod.call(this.shareaboutsView,"show")},showPageSections:function(){this.sectionList.show(new this.sectionListView({model:this.model,collection:this.pageSections,parent:this}))},toggleMobileMenu:function(){b("#mobilemenu a").click(function(){b("#mobilemenu-container .active").removeClass("active")})},onShow:function(){this.showShareaboutsSection(),this.showPageSections(),this.toggleMobileMenu()}}))}(Planbox,jQuery);var Planbox=Planbox||{};!function(a,b){"use strict";a.BaseShareaboutsSectionView=a.ShareaboutsSectionView,a.ShareaboutsSectionView=a.BaseShareaboutsSectionView.extend({className:"project-section-shareabouts project-shareabouts",getShareaboutsEl:function(){return this.$el},onShow:function(){a.BaseShareaboutsSectionView.prototype.onShow.apply(this,arguments),this.getShareaboutsEl().on("showpanel",function(){b("body").animate({scrollTop:0},"fast")})}})}(Planbox,jQuery);var Planbox=Planbox||{};!function(a,b){"use strict";a.genericException=function(a,b,c){var d=new Error(b);return d.name=a,d.data=c,d},a.app=new Backbone.Marionette.Application,a.app.addRegions({mainRegion:"#page",modalRegion:"#modal-container"}),a.app.addInitializer(function(){Backbone.Marionette.TemplateCache.prototype.compileTemplate=function(a){return Handlebars.compile(a)}}),a.app.addInitializer(function(){window.addEventListener("dragover",function(a){a=a||event,a.preventDefault()},!1),window.addEventListener("drop",function(a){a=a||event,a.preventDefault()},!1)}),b(function(){a.app.start()}),b(window).load(function(){b(document).foundation({magellan:{}})})}(Planbox,jQuery);var Planbox=Planbox||{};!function(a){"use strict";a.projectException=function(a,b){return genericException("ProjectException",a,b)},a.app.addInitializer(function(){var b;a.Data.isEditable&&!a.Data.project.owner_id&&(a.Data.project.owner=_.clone(a.Data.owner)),a.Data.isEditable&&(a.app.plugins=[],a.app.plugins.push(new a.ShareaboutsProjectEditorPlugin(a.app))),a.app.projectModel=new a.ProjectModel(a.Data.project),a.app.sectionCollection=a.app.projectModel.get("sections"),a.Data.isEditable?b=a.ProjectAdminView:(b=a.ProjectView,a.app.sectionCollection=new Backbone.Collection(a.app.projectModel.get("sections").filter(function(a){return a.get("active")
}))),a.app.mainRegion.show(new b({className:a.app.projectModel.get("layout")+"-page",model:a.app.projectModel,collection:a.app.sectionCollection})),-1!==window.location.pathname.indexOf("/new/")&&a.Data.isEditable}),a.app.addInitializer(function(){window.addEventListener("beforeunload",function(b){var c="It looks like you have unsaved changes in your project.";return b=b||event,a.app.projectModel.isDirty?(b.returnValue=c,c):void a.app.projectModel.markAsClosed()},!1)}),a.app.addInitializer(function(){a.Data.isEditable?a.Utils.logEvents("body","project-editor"):a.Utils.logEvents("body","project-page")})}(Planbox,jQuery);
//# sourceMappingURL=project-display-shareabouts-app.min.map